variables:
  GIT_DEPTH: 5

stages: 
  - deploy

image: bozdoz/fabric-deployment

.deploys:
  stage: deploy
  script:
    - fab gitpull dockercomposebuild dockercomposerestart
  
deploy:
  extends:
    - .deploys
  variables:
    CWD: ~/bozdoz.com/v2
  environment:
    name: production
    url: https://bozdoz.com
  only:
    - master

deploy_staging:
  extends:
    - .deploys
  variables:
    CWD: ~/staging-bozdoz/public_html
  environment:
    name: staging
    url: https://staging.bozdoz.com
  only:
    - staging